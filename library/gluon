#!/usr/bin/lua

-- read input
local json    = require 'luci.jsonc'
local fs      = require 'nixio.fs'
local platform_info = require('platform_info')
local util = require 'luci.util'
local sys = require 'luci.sys'

fail = function (msg)
  print(json.stringify({failed=true, msg=msg}))
  os.exit(1)
end



local function unameArg(arg)
  return util.trim(sys.exec("uname " .. arg))
end
facts = {}
facts["gluon_release"] = util.trim(fs.readfile("/lib/gluon/release"))
facts["image_name"]    = platform_info.get_image_name()
facts["board_name"]    = platform_info.get_board_name()
facts["uname"]         = {machine=unameArg("-m"), version=unameArg("-v")}

print(json.stringify({ansible_facts=facts}))
